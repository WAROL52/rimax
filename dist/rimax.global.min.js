var Rimax=function(e){"use strict";const t=e=>e,n=Symbol("$$State"),r=(e=>"object"==typeof e&&n===e[".rxType"]).bind();class s{get isArray(){return Array.isArray(this.value)}toString(){return String(this.value)}valueOf(){return this.value}get".rxType"(){return n}static isState=r}function o(e,t){let n,r,o=!1,c=0;const u=Math.random(),l=[],f=new Set,d=new Set,p={};return Object.freeze(new class extends s{get guards(){return[...l]}get isDestroyed(){return o}get id(){return u}get len(){return{onChange:d.size,onCleanup:f.size,subscriber:c}}addGuard(e){if(!(e instanceof Function))return()=>{};const t=(...t)=>e(...t),n=l.push(t)-1;let r=!1;return()=>{if(r)return!0;if(l[n]===t)return l.splice(n,1),r=!0,!0;const e=l.find((e=>e===t));return e>-1&&(l.splice(e,1),!0)}}clear(e=!1){f.forEach((t=>t(e))),f.clear(),d.clear()}destroy(e=!0){o||(this.clear(e),o=!0)}onChange=((e,t=!1)=>{if(e instanceof s){const n=t instanceof Function?t:e=>e,r=e;let s;return c++,this.onChange(((...e)=>(r.set((()=>n(...e)),...e.slice(1)),()=>{s||(s=!0,c--)})),!0)}if(!(e instanceof Function))throw new Error("callback doit être une fonction");const n={dispatch:e,destroy:t?e(this.value,void 0,{methode:"set",value:this.value}):void 0},r=(...e)=>n.destroy=n.dispatch(...e);let o=!1;const i=(...e)=>{o||(o=!0,n.destroy instanceof Function&&n.destroy(...e),f.delete(i),d.delete(r))};return d.add(r),f.add(i),i}).bind();onCleanup=(e=>{if(!(e instanceof Function))throw new Error("callback doit être une fonction");return f.add(((...t)=>e(...t))),()=>f.delete(e)}).bind();get oldValue(){return r}constructor(e,t=(e=>e)){if(super(),Object.defineProperty(this,"value",{get:(()=>n).bind(),set:(e=>this.set(e)).bind(),enumerable:!0}),t&&"object"==typeof t&&(Object.assign(p,t.actions??{}),t=t.guard??(e=>e)),!(t instanceof Function))throw new Error("guard doit être une fonction");n=e,l.push(t);const c=(e,t=r,n={})=>{const s=[];return l.reduceRight(((e,r)=>(s.push(e),r(e,t,n,[...s]))),e)};e instanceof Promise||(n=c(e,void 0,{}));const u=(e=(()=>n),t=[],i=(e=>e))=>{if(!(e instanceof Function))throw new Error("callback doit être une function");if(o)throw new Error("cette Etat ne peut plus etre utiliser car elle est deja detruit");const c=t&&!Array.isArray(t)&&"object"==typeof t?t:{};if(t=Array.isArray(t)?t:c.dependencies??[],!Array.isArray(t))throw new Error("dependencies doit être une Array");const u=(t={})=>e(n,r,t),l={guard:i,...c},[f,d]=a(u(),l);l.guard!==i&&f.addGuard(i);const p=[this,...t].map((e=>{if(e instanceof s)return e.onChange(((e,t,n)=>(d(u(n),n),()=>!f.isDestroyed&&f.destroy(!0))))}));return f.onCleanup((()=>p.map((e=>e instanceof Function&&e())))),f};this.get=((e=(()=>this.value),t=[])=>u(e,t)).bind(),Object.entries(i).map((([e,t])=>this.get[e]=(e=(()=>this.value),n=[])=>u(e,n,t))),this.set=((e,t={methode:"set",value:e})=>{if(o)throw new Error("cette Etat ne peut plus etre utiliser car elle est deja detruit");if("object"!=typeof t)throw new Error("option doit être un object");if(e instanceof Promise)return e.then((e=>this.set(e)));e instanceof s&&(e=e.value),e instanceof Function&&(e=e(n,r));const i=n;return i!==e&&(e=c(e,i,t),r=i,n=e,(e=>{d.forEach((t=>t(n,r,e)))})(t)),n}).bind(),function(e,{createStateComputed:t}){const n=e,r=()=>{if(!n.isArray)throw new Error("pour pouvoir utiliser cette methode le type de state doit être une Array")},o=e=>{if(!(e instanceof Function))throw new Error("callback doit doit être une function")},i=e=>{if(e instanceof s&&(e=e.value),e instanceof Function&&(e=n.value.findIndex(e)),isNaN(e))throw new Error("index doit être une nombre ou une fonction qui retourne un nombre");return e};n.get.map=e=>{o(e);const t=(e,t)=>[a(e)[0],a(t)[0]],r=t=>e(...t,n),s=n.value.map(t);let i=s.map(r);const[c,u]=a(i),l=()=>s.map((([e,t],r)=>{t.isDestroyed||t.set(r),e.isDestroyed||e.set(n.value[r])}));return n.onChange((e=>{if(s.length>e.length){const t=e.length,n=s.length;s.splice(t,n).map((e=>e.map((e=>e.destroy(!0))))),u.splice(t,n)}else if(s.length<e.length){const n=s.length;s.push(...e.slice(n).map(t)),s.map((([,e],t)=>e.set(t))),u.push(...s.slice(n).map(r))}l()})),c},n.get.callback=e=>{if(!(e instanceof Function))throw new Error("callback doit être une function");return n.get((()=>e))};const c=(e,t)=>{if(r(),n.value[t]instanceof Function){const r=n.value[t](...e);return n.set([...n.value],{methode:"set",action:t,args:e,returnValue:r})}};n.set.splice=(...e)=>c([...e],"splice"),n.set.remove=(e,t=1)=>{const r=n.value.splice(e,t);return n.set([...n.value],{methode:"set",action:"remove",args:[e,t],returnValue:r})},n.set.edit=(e,t)=>{if(r(),(e=i(e))>-1){t instanceof Function&&(t=t(n.value[e],e,n.value));const r=n.value.splice(e,1,t);return n.set([...n.value],{methode:"set",action:"edit",args:[e,t],returnValue:r})}},n.set.push=(...e)=>c([...e],"push"),n.set.pop=()=>c([],"pop"),n.set.shift=()=>c([],"shift"),n.set.unshift=(...e)=>c([...e],"shift"),n.set.reverse=()=>c([],"reverse"),n.set.fill=(...e)=>c([...e],"fill"),n.set.filter=(e,...t)=>{r(),o(e);const s=n.value.filter(e,...t);return n.set(s,{methode:"set",action:"filter",args:[e,...t],returnValue:s})},n.set.slice=(...e)=>{r();const t=n.value.slice(...e);return n.set(t,{methode:"set",action:"slice",args:e,returnValue:t})},n.set.sort=(e=((e,t)=>t-e))=>{r(),o(e);const t=n.value.slice(),s=n.value.sort(e);return s.every(((e,n)=>e===t[n]))?n.value:n.set(s,{methode:"set",action:"sort",args:arguments,returnValue:s})},n.set.map=(e,t=n.value)=>{r(),o(e);const s=n.value.map(e,...args);return n.set(s,{methode:"set",action:"map",args:args,returnValue:s})}}(this,{createStateComputed:u}),Object.entries(p).map((([e,t])=>this.set[e]=e=>this.set(t instanceof Function?t(n,e):t))),e instanceof Promise&&e.then((e=>this.set(e)))}}(e,t))}const i={array(e){if(!Array.isArray(e))throw new Error("cette state doit être de type Array");return e},number(e){if("number"!=typeof e)throw new Error("cette state doit être de type Number");return e},string(e){if("string"!=typeof e)throw new Error("cette state doit être de type string");return e},function(e){if("function"!=typeof e)throw new Error("cette state doit être de type function");return e},boolean(e){if("boolean"!=typeof e)throw new Error("cette state doit être de type boolean");return e},symbol(e){if("symbol"!=typeof e)throw new Error("cette state doit être de type symbol");return e},object(e){if("object"!=typeof e)throw new Error("cette state doit être de type object");return e}};function a(e,n=t){return e instanceof s?n instanceof Function&&n!==t&&e.addGuard(n):Array.isArray(e)&&e[0]instanceof s&&e[1]===e[0].set?(e=e[0],n instanceof Function&&n!==t&&e.addGuard(n)):e=o(e,n),[e,e.set]}Object.entries(i).map((([e,t])=>a[e]=e=>a(e,t))),a.isState=r;const c=Symbol("$$ref");function u(e){const[t,n]=a(e),r=Object;return r.freeze(new class{constructor(){r.defineProperty(this,"current",{get:(()=>t.value).bind(),set:(e=>n(e)).bind(),enumerable:!0,configurable:!1}),r.defineProperty(this,"onChange",{value:(e=>t.onChange(e)).bind(),enumerable:!0})}onCleanup(e){return t.onCleanup(e)}destroy(e){return t.destroy(!0)}set(e){return n(e)}get".rxType"(){return c}})}function l(e={}){if("object"!=typeof e)throw new Error("props doit être une object");return{...Object.entries(e).reduce(((e,[t,n])=>({...e,[t]:"children"===t||t.startsWith("$")||a.isState(n)?n:a(n)[0]})),{})}}u.isRef=(e=>"object"==typeof e&&c===e[".rxType"]).bind();const f={beforeDispatch:(...e)=>[...e],afterDispatch:(e,t)=>[e,t],onSubscribe:e=>e,clearAfterEachDispatch:!1};function d(e=f){if("object"!=typeof e)throw new Error("handler doit être un object");const{beforeDispatch:t=f.beforeDispatch,afterDispatch:n=f.afterDispatch,onSubscribe:r=f.onSubscribe,clearAfterEachDispatch:s=f.clearAfterEachDispatch}=e,o=new Set;return[e=>{if(!(e instanceof Function))throw new Error("callback doit être un function");return(e=r(e))instanceof Function&&o.add(e),()=>o.delete(e)},(e,...r)=>{const i=t(e,...r),a=o.forEach((e=>e?.(...Array.isArray(i)?i:[i])));return s&&o.clear(),n(e,a)}]}function p(e,t=[]){if(!Array.isArray(t))throw new Error("states doit être une Array");const n=[],[r,o]=a(),i=[...t],c=e=>e instanceof s?e.value:e,u=t=>o(e([...i.map(c)],t));return i.forEach(((e,t)=>{e instanceof s&&n.push(e.onChange((()=>{u(t)})))})),u(-1),r.onCleanup((()=>n.splice(0,n.length).map((e=>e?.())))),r}const h=new WeakMap;function m(e){if(!(e instanceof Node))throw new Error("dom doit etre un instance de Node");if(h.get(e))return h.get(e);let t=!1,n=[];const[r,o]=d({clearAfterEachDispatch:!0}),[i,a]=d({clearAfterEachDispatch:!0});let c=!1;r((()=>c=!0)),e.childNodes;const u=new Text,l=new Text;const f={getFiber:()=>null,attr:(t,n)=>e instanceof Element?t&&void 0!==n?(e.setAttribute(t,n||""),e.getAttribute(t)):t?e.getAttribute(t):e.attributes:null,style:(t,n)=>{if(e instanceof Element){if(void 0===n)return e.style[t];e.style[t]=n}return e.style[t]},addClass:t=>e instanceof Element&&e.classList.add(t),hasClass:t=>e instanceof Element&&e.classList.contains(t),removeClass:t=>e instanceof Element&&e.classList.remove(t),toggleClass:t=>e instanceof Element&&e.classList.toggle(t),on:(t,n)=>{const r=e=>n instanceof Function&&n(e);return e.addEventListener(t,r),()=>e.removeEventListener(t,r)},getFiber:()=>null,onConnected:i,dispatchConnected:a,onReady:r,dispatchReady:o,getTextRoot:()=>Promise.resolve().then((()=>(e.parentNode?(e.after(u),e.after(l)):l.parentNode&&l.after(u),u))),destroy:(r=!1)=>{e instanceof Node&&!(e instanceof DocumentFragment)&&e.remove(),t||(n.map((e=>e instanceof Function&&e(r))),t=!0,n=[],e instanceof Text&&r&&(e.data=""))},onCleanup:function(e){if((()=>{if(t)throw new Error("cette dom est deja considerer comme detruit, donc vous ne peux plus faire cette action...")})(),e instanceof s&&e.value instanceof Function){const t=e;e=(...e)=>{if(!(t.value instanceof Function))throw new Error("state.value doit etre une function");t.value(...e)}}else if(Array.isArray(e))return void e.map((e=>handler.onDestroy(e)));e instanceof Function&&n.push(e)},isReady:()=>c,isDestroyed:()=>t,isConnected:()=>isConnected,isCleaned:()=>isClean,get textRef(){return u},id:123};Object.freeze(f),f.onConnected((()=>{e.parentNode&&e.after(l)}));const p=setInterval((()=>{e.parentElement&&(clearInterval(p),a(e.parentElement))}),10);return h.set(e,f),f}const y={fr:{0:e=>""},en:{}},g=[];function b(...e){return new RegExp(`(?:${function(...e){return e.reduce(((e,t)=>new RegExp(e.source+function(e){return"string"==typeof e?e:e.source}(t))))}(...e).source})`)}function v(...e){return new RegExp(`(${function(...e){return e.reduce(((e,t)=>new RegExp(e.source+t.source)))}(...e).source})`)}function w(...e){return v(e.reduce(((e,t)=>new RegExp(e.source+"|"+t.source))))}!function({code:e,lang:t={fr:e=>"rxError",en:e=>"rxError"}}){if(g.includes(e))throw new Error("ce code is already used");if("object"!=typeof t)throw new Error("lang must be an object");g.push(e),Object.entries(t).map((([t,n])=>{y[t][e]=e=>{if(!(n instanceof Function))throw new Error("each value of lang must be a function");return n(e)}}))}({code:0,lang:{fr:e=>`rxError:${e}`,en:e=>`rxError:${e}`}});class E extends Array{static get regExp(){return/\(_\|-\[RXRefs\{index:\d+,type:[\w\$]+\}\]-\|_\)/}static get regExpSaved(){return/\(_\|-\[RXRefs\{index:(?<index>\d+),type:(?<type>[\w\$]+)\}\]-\|_\)/}static get regExpSavedG(){return/\(_\|-\[RXRefs\{index:(?<index>\d+),type:(?<type>[\w\$]+)\}\]-\|_\)/g}static{this.split=function(e="",t=!0){if("string"!=typeof e)throw new Error("chaine doit etre une chaine de caractere");const n=t?w(this.regExp):this.regExp;return e.split(n).reduce(((e,n)=>{if(!n)return e;const r=this.parse(n);return r&&t instanceof Function&&(n=t(r)),e.push(n),e}),[])},this.replaceAll=function(e,t=""){if("string"!=typeof e)throw new Error("chaine doit etre une chaine de caractere");return e.replaceAll(this.regExpSavedG,((e,n,r)=>t instanceof Function?t({input:e,index:n,type:r}):t))},this.parse=function(e="",t=null){if("string"!=typeof e)throw new Error("chaine doit etre une chaine de caractere");const n=/\(_\|-\[RXRefs\{index:(?<index>\d+),type:(?<type>[\w\$]+)\}\]-\|_\)/.exec(e),r=t?this.split(e,(({index:e})=>t[e])):null,s=r?r.join(""):"";return n?{index:n.groups.index,type:n.groups.type,input:n.input,value:r,valueString:s,refs:t}:null}}constructor(...e){super(),this.push(...e),this.components={}}}const x={},A={el:null,attrName:"",attrValue:"",directiveName:"",arg:"",modifiers:{},index:0};class C{#e={...x};get components(){return this.#e}set components(e){Object.assign(this.#e,e)}refs=new E;directives={$onInit({attrValue:e,el:t}=A){(e=e instanceof s?e.value:e)instanceof Function?m(t).onCleanup=e(t):console.warn("$onInit.attrValue doit être de type Function")},$shadowRoot({attrValue:e,el:t,arg:n}=A){const r=["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"];if(r.includes(t.localName)||t.localName.includes("-")){let r;e instanceof s&&(e=e.value),e instanceof Function&&(r=e);const o=[...t.childNodes],i=t.attachShadow({mode:"closed"===n?"closed":"open"}),a=r instanceof Function?r({el:t,root:i,children:o}):o,c=Array.isArray(a)?a:[a];t.innerHTML="",i.append(...c)}else console.warn(`l'element ${t.localName} ne suporte pas le attachShadow. Seule les element personnalisé (balise avec un tiré) et quelque element native le supporte,\n                voici une liste d'element qui le support:`,r)},$attrState({attrValue:e,el:t,setAttribute:n}=A){let r;if(e instanceof s){const s=(e,s)=>{r instanceof Function&&r(),r=n(t,e,s??"")};return e.onChange(((e,t)=>{if(e&&"object"==typeof e)if(t&&"object"==typeof t){e.attrName===t.attrName&&e.attrValue===t.attrValue||s(e.attrName,e.attrValue??"")}else s(e.attrName,e.attrValue??"");else s(e,"");return r}),!0)}return n(t,e,!0)},$if({attrValue:e,el:t,index:n,data:r,arg:o}=A){n=Math.random(),"object"!=typeof r.listCondition&&(r.listCondition={});const i=e=>e instanceof Function?e(t):!!e,a=()=>Object.values(r.listCondition).every((e=>e)),c=(e=a())=>m(t).getTextRoot().then((n=>n.parentNode?n.parentNode&&e?n.after(t):t.remove():m(t).onConnected((()=>m(t).getTextRoot().then((()=>a()?n.after(t):t.remove()))))));return e instanceof s?e.onChange((t=>{const s=i(t);return r.listCondition[n]="false"==o?!s:s,c(),()=>{delete r.listCondition[n],e.destroy(!0)}}),!0):(r.listCondition[n]=i(e),c(),()=>r.listCondition[n]=!0)},$ref({el:e,attrValue:t}=A){if(t instanceof s&&(t=t.value),t instanceof Function)return t(e);u.isRef(t)&&(t.current=e)},$show({el:e,attrValue:t}=A){if(t instanceof s)return t.onChange((n=>(e.hidden=!n,()=>t.destroy(!0))),!0);e.hidden=!t},$bind({el:e,arg:t,modifiers:n,attrValue:r}=A){const o=[];r instanceof s&&o.push(r.onChange((n=>(t in e?e[t]=n:e.setAttribute(t,n),()=>r.destroy(!0))),!0));const i=()=>{const n=t in e?e[t]:e.getAttribute(t);r instanceof s&&r.set(n)};if(o.push(...Object.keys(n).map((t=>(e.addEventListener(t,i),()=>e.removeEventListener(t,i))))),0==Object.keys(n).length){const t=["input"].includes(e.localName)?"input":"change";e.addEventListener(t,i),o.push((()=>e.removeEventListener(t,i)))}return()=>o.map((e=>e()))},$directives({el:e,arg:t,modifiers:n,attrValue:r}=A){r instanceof s&&(r=r.value),"object"==typeof r&&Object.assign(this,r)}};initProps(e=this.refs){if(!(e instanceof E))throw new Error("refs must be an instance of RXRefs");const t=({index:e})=>this.refs[e],n=(e,t)=>{if(t in e){if(t.includes("<")&&t.includes(">")&&">"==t.at(-1)){const e=t.indexOf("<");t=t.slice(0,e)}return(()=>{let n=Math.round(1e8*Math.random());for(;t+`<${n}>`in e;)n++;return t+=`<${n}>`})()}return t};this.props=Object.entries(this.props).reduce(((e,[r,o])=>{const i=E.parse(r,this.refs),a="string"==typeof o?E.split(o??"",t):[o];!/^\s*$/.test(a[0])||a[0]instanceof s||a.shift(),!/^\s*$/.test(a.at(-1))||a[0]instanceof s||a.pop();let c,u=!1;const l=()=>{if(u)return c;if(u=!0,0==a.length)return c="","";if(1==a.length)return c=a[0],a[0];const e=p((()=>a.join("")),a);return c=e,e};if(i){let t=!1;const a=!!i.value.find((e=>(e instanceof Function&&(t=!0),e instanceof s))),c=()=>p((()=>({attrName:i.value.map((e=>e instanceof Function?e.name:e instanceof s?e.toString():"object"==typeof e?e?.constructor?.name:e)).join(""),attrValue:l()})),[...i.value]);if("$"==i.value[0]&&i.value[1]instanceof Function){const t=i.value[1],r=Math.round(1e6*Math.random()),s=("$"==t.name[0]?t.name:"$"+t.name)+"{"+r+"}";this.directives[s]=t;let o="$attrState";o=n(e,o),i.value[0]="",i.value[1]=s;const a=c();return e[o]=a,e}if(a){let t="$attrState";t=n(e,t);const r=c();return e[t]=r,e}if(t){const t=[...i.value];if(t[0]instanceof Function&&1==t.length){let r="$onInit";return r=n(e,r),e[r]=t[0],e}{let t=[...i.value].map((e=>e instanceof Function?e.name:e)).join("");return t=n(e,t),e[t]=l(),e}}if(i.value[0]instanceof Object&&1===i.value.length)return""!=o||i.value[0].constructor!==Object||Object.entries(i.value[0]).map((([t,r])=>{t=n(e,t),e[t]=r})),e;r=i.valueString}let f=!1;return":"==r[0]&&(f=!0,r=r.slice(1)),"children"==r?(e.children=o,e):(r=n(e,r),e[r]=f?p((()=>l())):l(),e)}),{})}constructor(){}type;props;#t;#n;get parent(){return this.#n}set parent(e){if(!(e instanceof C))throw new Error("parentFiber doit être une instance FiberOfNode");this.#n=e}get dom(){return this.#t}set dom(e){if(this.#t)throw new Error("dom a déja une valeur Node ");if(!(e instanceof Node))throw new Error("domValue doit être une instance de Node");this.#t=e}}class j extends C{constructor(e,t={},n=new E){if(!(n instanceof E))throw new Error("refs must be an instance of RXRefs");super(),this.type=e,this.refs=n,this.props=Object.freeze({...t,children:t.children??[]}),this.props.children.map(((e,t)=>{e instanceof DocumentFragment&&(this.props.children[t]=[...e.$children])})),this.initProps(this.refs),this.components=this.refs.components,this.components[e]&&(this.type=this.components[e]),Object.freeze(this)}}class F extends C{constructor(e,t=new E){if(!(t instanceof E))throw new Error("refs must be an instance of RXRefs");super(),this.refs=t,this.type="FRAGMENT",this.props=Object.freeze({children:e??[]}),this.initProps(this.refs),Object.freeze(this)}}class N extends C{constructor(e,t=new E){if(!(t instanceof E))throw new Error("refs must be an instance of RXRefs");return super(),this.refs=t,this.type="TEXT",this.props=Object.freeze({nodeValue:e,children:[]}),Object.freeze(this),this.props.nodeValue instanceof Node?(this.props.nodeValue instanceof DocumentFragment&&console.log([...this.props.nodeValue.$children]),this.props.nodeValue):this.props.nodeValue instanceof C?this.props.nodeValue:void 0}}const R=(e,t,n)=>e.apply(n,t);R.after=(e,t,n)=>Promise.resolve().then((()=>e.apply(n,t))),R.idle=(e,t,n)=>requestIdleCallback((()=>e.apply(n,t)));const $={set(e,t,{methode:n,value:r,textRef:s,listElement:o}){if(!Array.isArray(o))throw new Error("listElement doit être une Array");if(!Array.isArray(e))throw new Error("valueOfState doit être une Array");if(s.$firstElement=o[0],e.every((e=>e instanceof Node))){const t=[];o.splice(0,o.length,...e.map(((e,n)=>{const r=V(e);return 0==n?s.$firstElement!==r&&(s.$firstElement=r,s.after(r)):o[n]!==r&&t.at(-1).after(r),t.push(r),r}))).map((e=>!o.find((t=>t===e))&&m(e).destroy(!0)))}else o.splice(0,o.length,...e.map((e=>{const t=V(e);return s.before(t),t}))).map((e=>m(e).destroy()))}};function O(e,t){if(!(t.props.nodeValue instanceof s))return e;let n=t.props.nodeValue;const r=Array.isArray(n.value)?new DocumentFragment:e;if(t.dom=r,Array.isArray(n.value)&&r.append(e),!(e instanceof Text))throw new Error("textDom doit être une instance de Text");let o=[];return R.after((()=>function(e,t,n,r){const s=e.onChange(((n,o,{methode:i,value:a,...c})=>{if(o instanceof Node&&n!==o&&o.destroy(!0),n instanceof Node)r.splice(0,r.length).map((e=>e instanceof Node&&e.destroy())),t.data="",R.idle((()=>t.after(n))),r.push(n);else if(t.data=n,Array.isArray(n)){t.data="";const e=[n,o,{...c,methode:i,value:a,listElement:r,textRef:t}];R.after((()=>{$[i]instanceof Function?$[i](...e):$.set(...e)}))}else if(n instanceof C){t.data="",r.splice(0,r.length).map((e=>e instanceof Node&&e.destroy()));const e=V(n);r.push(e),e.onDestroy((()=>r.length&&s()));let o=!1;const i=(e,t,n=!1)=>!(!o||n)||!!e.parentNode&&(e.after(t),o=!0,!0),a=()=>{if(i(t,e),!o)return requestIdleCallback(a)};requestIdleCallback(a),t.onConnected((n=>{if(n instanceof Node&&t.parentNode!==n)return n.append(t),i(t,e,!0);i(t,e)}))}else if("object"==typeof n)try{t.data=JSON.stringify(n,null,20)}catch(e){}return(n=!0)=>{t.data="",r.map((e=>e.destroy(n))),o instanceof Node&&o.destroy(),n&&(t.remove(),e.destroy(!0))}}),!0);m(n).onCleanup(s)}(n,e,r,o))),r}const S=["style","link"];function T(e,t=document.body){if("string"==typeof t&&(t=document.querySelector(t)),!(t instanceof Node))throw new Error("container doit être de type Node");let n;const r=function(e){if(!(e instanceof Node))throw new Error("container doit être de type Node");const t=new Text("");return e.shadowRoot?e.shadowRoot.append(t):e.append(t),t}(t);function s(e){if(Array.isArray(e))return n=e.map((e=>T(e,t))),n;m(t).onCleanup(m(e).onCleanup);r.after(e),m(e).dispatchConnected(t),r.remove(),n=e}if(((e,t)=>!!S.includes(String(e?.type).toLowerCase())||!!S.includes(t.localName)||void 0)(e,t)){s(V(e))}return async function(){if(n)return n;if(!(t instanceof Node))throw new Error("container doit etre un instance de Node");return s(await R.after((()=>V(e)))),n}()}function V(e){if(e instanceof C&&e.dom instanceof Node)throw new Error("fibre a déja une instance dom, fais une copie du fibre si vous voulez une autre instance");if(Array.isArray(e))return e.flat(1/0).map((e=>V(e)));e instanceof Function?e=new j(e,{children:[]}):e instanceof EventTarget||e instanceof C||(e=new N(e));const t=function(e){const t=e=>e.flat(1/0).map((e=>V(e)));if(e instanceof Node)return e;if(e instanceof C&&e.dom instanceof Node)return e.dom;if(e instanceof F)return t(e.props.children);if(e instanceof N)return Array.isArray(e.props.nodeValue)?t(e.props.nodeValue):e.props.nodeValue instanceof Node?e.props.nodeValue:new Text(e.props.nodeValue);if(e instanceof j){if(e.components[e.type]instanceof Function){const t=e.components[e.type];e.type=t}if(e.type instanceof Function){let t=e.props;return"object"==typeof e.type.defaultProps&&(t={...e.type.defaultProps,...t}),V(e.type(t))}return document.createElement(e.type)}if(Array.isArray(e))return t(e);if(e instanceof Function){let t={children:[]};return"object"==typeof e.defaultProps&&(t={...e.defaultProps,children:[]}),V(e(t))}if(e instanceof s)return V(new N(e,new E));try{return new Text(JSON.stringify(e))}catch(t){return new Text(e)}}(e);e instanceof C&&t instanceof Node&&!(t.fiber instanceof C)&&Object.defineProperty(t,"fiber",{get:()=>e});if(Array.isArray(t)){if(e.parent instanceof C)return t;const n=new DocumentFragment;return n.append(...t),n}return(t=>{if(e instanceof Node)return t;if(e instanceof N&&s.isState(e.props.nodeValue))return O(t,e);if(e&&e.type instanceof Function)return t;const n=[];if(e instanceof C){if(e.dom=t,!e.props.children)return t;n.push(...e.props.children.flat(1/0).map((n=>("object"!=typeof e.components&&(console.warn("fiber.component doit être une object"),e.components={}),n instanceof C&&(n.parent=e,Object.assign(n.directives,e.directives),n.components=e.components),T(n,t)))))}return Promise.all(n).then((n=>{!function(e,t){if(!(e instanceof Node))throw new Error("dom doit etre un element node");if(!(e instanceof HTMLElement))return null;if(t&&t.type instanceof Function)return null;if(!(t instanceof j))return null;const n={},r={},o=(e,[i,a],c,u=[])=>{const l=(e,t=c,n=i)=>{if(!/^\s*$/.test(n)){if(t instanceof HTMLSelectElement&&["multiple"].includes(n))t.multiple=!0;else{if(["disabled","hidden"].includes(n))return t[n]=""===e||e;if(n in t||["object","function"].includes(typeof e))return"object"==typeof e&&"object"==typeof t[n]?Object.assign(t[n],e):t[n]=e}t.setAttribute(n,e)}},f=(t,n,r)=>{const s=[];return o(e,[n,r],t,s),()=>R((()=>s.map((e=>e instanceof Function&&e()))))},d=(e,t)=>{const n=t=>{t instanceof s?m(c).onCleanup(t.onChange(((n,r)=>(e(n,r),()=>t.destroy())),!0)):e(t)};Array.isArray(a)?a.map((e=>n(e))):n(a),m(c).onCleanup((()=>t instanceof Function&&t()))},p=()=>null;let h,y=p;const g=a,b=/^([^<>]+)<\d+>$/.exec(i);if(b&&(i=b[1]),"children"==i||!(t instanceof j))return e;if("string"!=typeof i)return e;if(i&&(i.startsWith("on")||i.startsWith("@"))){let t=i.slice(i.startsWith("on")?2:1).toLowerCase();t.indexOf("<")>-1&&(t=t.slice(0,t.indexOf("<")));const n=(e,t=[])=>(e instanceof s&&(e=e.isDestroyed?()=>null:e.value),e(...t)),r=(...e)=>{if(Array.isArray(a))return a.map((t=>n(t,e)));n(a,e)};let o=()=>c.removeEventListener(t,r);return m(c).onCleanup(o),c.addEventListener(t,r),y=()=>o,e}if("."==i[0]){const t=c[i.slice(1)];return c[i.slice(1)]=a,y=()=>c[i.slice(1)]=t,e}if(h=/^(?<name>(?:\$|\:)[^\s</>\:\[\]]+)(?:\:(?<arg>[^\s</>:\[\]]*)(\[(?<modifiers>[^\s</>\[\]]*)\])?)?(?:\<(?<index>\d+)\>)?$/.exec(i)){const{name:s,arg:o,modifiers:l}=h.groups;if(r[s]=s in r?r[s]+1:0,t.directives[s]instanceof Function){let e=r[s];(["$ref"].includes(s)?R:R.after)((()=>{n[s]||(n[s]={});const r=t.directives[s]({setAttribute:f,globalData:n,data:n[s],el:c,attrName:i,attrValue:a,index:e?Number(e):0,directiveName:s,arg:o,modifiers:l?.split(",").reduce(((e,t)=>(e[t]=!0,e)),{})||{}});r instanceof Function&&(m(c).onCleanup(r),y=r,u.push(y))}))}return e}if(["input","select","textarea"].includes(c.localName)&&["value","checked"].includes(i)&&g instanceof s){["select"].includes(c.localName)&&c instanceof HTMLSelectElement&&(c.value=g.value,m(c).onReady((()=>{c.selectedIndex=-1;let e=-1;for(let t of c)e++,t.value===g.value&&(c.selectedIndex=e)})));const e=e=>R.after((()=>["checkbox"].includes(e.target.type)?g.set(e.target.checked):g.set(e.target[i])));c.addEventListener("input",e),y=()=>{c.removeEventListener("input",e),c.value=""},m(c).onCleanup(y)}else{if("style"==i||/^style<\d+>/.test(i)){const t=c.style.cssText,n=e=>R.after((()=>{e instanceof Object?Object.assign(c.style,e):c.style.cssText+=e}));return d(n,(()=>n(t))),e}if("class"==i||/^class\<\d+\>/.test(i)){const t=c.getAttribute("class"),n=(e,t)=>R.after((()=>{const n=e=>String(e).split(" ").map((e=>e&&c.classList.add(e))),r=e=>String(e).split(" ").map((e=>e&&c.classList.remove(e)));Array.isArray(t)?t.map((e=>r(e))):r(t),Array.isArray(e)?e.map((e=>n(e))):n(e)}));return d(n,(()=>n(t))),e}if(i&&i.startsWith("?")){if(i=/^([^<>]+)\<\d+\>/.test(i)?i.slice(0,i.indexOf("<")):i,!a)return e;let t;const n=e=>{const t=e=>f(c,i.slice(1),e);if("object"!=typeof a)return t(e);{const{when:n,value:r}=e;if(n instanceof s){let e;return n.onChange((n=>(n?e||(e=t(r instanceof s?r.get():r)):(e&&e(),e=null),()=>e&&e())),!0)}if(n)return t(r)}};a instanceof s||(t=n(a));const r=()=>t();return r instanceof Function&&(c.onDestroy(r),y=r,u.push(y)),e}}if(a instanceof s){const e=a,t=e.onChange((t=>(l(t),()=>{e.destroy(!0),c.removeAttribute(i)})));m(c).onCleanup(t),a=a.value,u.push(t)}return l(a),y===p&&(y=()=>{c.removeAttribute(i)}),u.push(y),e};Object.entries(t.props).reduce(((t,[n,r])=>o(t,[n,r],e)),{})}(t,e),R.after((()=>m(t).dispatchReady(t,n)))})),t})(t)}const k=new WeakMap,D={defaultProps:{},shadowRoot:null};const P=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],L=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","marquee","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],M=/(<(?:\/\s*)?(?:[^\!<>\s"'=\/\\]+)\s*(?:(?:\s*(?<="|'|\s)[^<>\s"'=\/\\]+\s*=\s*"[^"]*"|\s*(?<="|'|\s)[^<>\s"'=\/\\]+\s*=\s*'[^']*'|\s*(?<="|'|\s)[^<>\s"'=\/\\]+\s*=\s*[^<>\s"'=\/\\]+|\s*(?<="|'|\s)[^<>\s"'=\/\\]+?)*)\s*(?:\/)?\s*>)/,I=/<(?<isClosingTag>\/\s*)?(?<type>[^\!<>\s"'=\/\\]+)\s*(?<attr>(?:\s*(?<="|'|\s)[^<>\s"'=\/\\]+\s*=\s*"[^"]*"|\s*(?<="|'|\s)[^<>\s"'=\/\\]+\s*=\s*'[^']*'|\s*(?<="|'|\s)[^<>\s"'=\/\\]+\s*=\s*[^<>\s"'=\/\\]+|\s*(?<="|'|\s)[^<>\s"'=\/\\]+?)*)\s*(?<isAutoClose>\/)?\s*>/,q=/^(?<attrName>[^<>\s"'`=\/\\]+)$/,X=/(?<="|'|`|\s*)[^<>\s"'`=\/\\]+\s*/,z=/^(?<attrName>[^<>\s"'`=\/\\]+)\s*=\s*"(?<attrValue>[^"]*)"$/,H=b(X,/\s*=\s*/,/"[^"]*"/),_=/^(?<attrName>[^<>\s"'`=\/\\]+)\s*=\s*'(?<attrValue>[^']*)'$/,W=b(X,/\s*=\s*/,/'[^']*'/),G=/^(?<attrName>[^<>\s"'`=\/\\]+)\s*=\s*`(?<attrValue>[^`]*)`$/,J=b(X,/\s*=\s*/,/`[^`]*`/),K=/^(?<attrName>[^<>\s"'`=\/\\]+)\s*=\s*(?<attrValue>[^<>\s"'`=\/\\]+)$/,B=w(H,W,J,b(X,/\s*=\s*/,/[^<>\s"'`=\/\\]+/),/\s+/);function Q(e){const t=I.exec(e);return t?!t.groups.isClosingTag:null}function U(e){const t=(e,t,n)=>{const r=(r=n,s=t)=>{if(e[s]){let t=Math.round(1e8*Math.random());for(;s+`<${t}>`in e;)t++;return e[s+`<${t}>`]=r,e[s]}return r};return t.startsWith("?")||t.startsWith("on")||["style","class"].includes(t)||/^(?<name>\$[^\s</>:\[\]]+)(?:\:(?<arg>[^\s</>:\[\]]*)(\[(?<modifiers>[^\s</>\[\]]*)\])?)?(?:\<(?<index>\d+)\>)?$/.exec(t)?r():isNaN(n)?n:Number(n)};return e.split(B).reduce(((e,n)=>{if(/^\s*$/.test(n))return e;let r;return(r=z.exec(n))||(r=_.exec(n))||(r=G.exec(n))||(r=K.exec(n))?e[r.groups.attrName]=t(e,r.groups.attrName,r.groups.attrValue):(r=q.exec(n))&&(e[r.groups.attrName]=""),e}),{})}function Y(e){const t=I.exec(e);if(!t)return null;const{type:n,attr:r,isAutoClose:s,isClosingTag:o}=t.groups;return{get isTagEmpty(){return P.includes(this.type)},get isTagKnown(){return L.includes(this.type)},type:n,attr:r,isAutoClose:s,isClosingTag:o,htmlTag:e,props:U(t.groups.attr),initType(e){if(!(e instanceof E))throw new Error("rxRefs must be instance of RXRefs");const t=E.parse(this.type,e);if(t&&2==t.value.length&&":"==t.value[0].at(-1)&&t.value[1]instanceof Function)return this.type=t.value[0].slice(0,-1),e.components[this.type]=t.value[1],this.type;let n=E.split(this.type,(({index:t})=>e[t]));return n=1===n.length?n[0]:n.join(""),"string"!=typeof n&&"function"!=typeof n&&(n=typeof n+".is-not-component-valid"),this.type=n}}}function Z(e,t,n){for(;t.length;){const s=t.shift();if(!/^\s*$/.test(s))if(Q(s)){const o=Y(s);o.children=[],o.initType(n),r=o.type,P.includes(r?.toLowerCase?.())||o.isAutoClose||ee(o,t,n);const i=new j(o.type,{...o.props,children:o.children},n);e.push(i)}else{const t=s.split(w(E.regExp,/{{[^{}]*}}/));/^\s*$/.test(t[0])&&t.shift(),/^\s*$/.test(t.at(-1))&&t.pop(),e.push(...t.map((e=>{const t="string"==typeof e?E.parse(e,n):e;if("string"!=typeof(e=t?t.value[0]:e))return e;const r=e=>/\s*\<\!--.*--\>\s*/.test(e);return r(e)?e.split(/(\s*\<\!--.*--\>\s*)/).map((e=>r(e)?document.createComment(/^\s*\<\!--(.*)--\>\s*$/.exec(e)[1]):e)).filter((e=>e)):new N(e,n)})))}}var r;return e}function ee(e,t,n){if(e.type instanceof Function&&!e.type.name)return;let r=1;const s=t.findIndex((t=>{const s=Y(t),o=E.parse(s?s.type:t,n);return!!(s&&(o&&o.value[0]===e.type||s.type===e.type)&&(r=s.isClosingTag?r-1:r+1,s.isClosingTag&&r<=0))}));if(-1===s?e.children=t.splice(0,t.length).filter((e=>!/^\s*$/.test(e))):(e.children=t.splice(0,s+1).filter((e=>!/^\s*$/.test(e))),e.children.pop()),"script"==e.type){let t=e.children.join("");const r=E.parse(t,n);r&&(t=r.valueString),e.children=[new Text(t)]}else e.children=Z([],e.children,n)}function te(e,t){if(!(t instanceof E))throw new Error("rxRefs must be instance of RXRefs");const n=function(e){return e.split(M)}(e),r=Z([],n,t);if(1==r.length){const e=r[0];return e instanceof C?e:new N(e,t)}return new F(r,t)}function ne(e,...t){let n;"object"==typeof t[0]&&!0===t[0]["<isStore>"]&&(n=t[0],t[0]="");const[r]=function(e,...t){return[[...t.reduce(((n,r,s)=>(n.push(e[s],`(_|-[RXRefs{index:${s},type:${typeof t[s]}}]-|_)`),n)),[]),e[t.length]].join(""),t]}(e,...t),s=te(r,new E(...t));return n&&(n.components&&"object"==typeof n.components&&(s.components=n.components),n.directives&&"object"==typeof n.directives&&(s.directives=n.directives)),s}function re(...e){return V(ne(...e))}const se=(e,t,n)=>e.apply(n,t);se.after=(e,t,n)=>Promise.resolve().then((()=>e.apply(n,t))),se.idle=(e,t,n)=>requestIdleCallback((()=>e.apply(n,t)));const oe="FRAGMENT",ie="TEXT";function ae(e,t,...n){const r=new LinksOfDataInTemplateString;return t=t??{children:[]},n=n.map((e=>e instanceof RcHtmlNode?e:new RcHtmlText(e,r))),e==oe?new RcHtmlFragment(n,r):e==ie?new RcHtmlText(n,r):new RcHtmlElement(e,{...t,children:n},r)}return ae.Fragment=oe,ae.Text=ie,re.map=function(e,t){const n=e instanceof s?[...e.value]:e;var[e,r]=a(e,(e=>(n.splice(0,n.length,...e),n)));const o=(e,t)=>[a(e)[0],a(t)[0]],i=n=>t(...n,e,(e=>{const[t,s]=n;return r.edit(s,e)})),c=e.value.map(o);let u=se.after((()=>c.map(i)));const[l,f]=a(u);return l.onChange((e=>se.after((()=>{if(!(e instanceof Promise||e.every((e=>e instanceof Node))))throw new Error("html.map doit retourner des list d'element Node")}))),!0),e.onChange((t=>{if(c.length>t.length){const e=t.length,n=c.length;c.splice(e,n).map((e=>e.map((e=>e.destroy(!0))))),f.splice(e,n)}else if(c.length<t.length){const e=c.length;c.push(...t.slice(e).map(o)),c.map((([,e],t)=>e.set(t))),f.push(...c.slice(e).map(i))}c.map((([t,n],r)=>se.after((()=>{n.isDestroyed||n.set(r),t.isDestroyed||t.set(e.value[r])}))))})),l},e.FiberOfElement=j,e.FiberOfFragment=F,e.FiberOfNode=C,e.FiberOfText=N,e.LinksOfDataInTemplateString=E,e.RXState=s,e.component=function(e,t={defaultProps:{}}){if("object"!=typeof t)throw new Error("option doit être une de type object");const n=t.defaultProps??{};if("object"!=typeof n)throw new Error("option.defaultProps doit être une de type object");const r=t=>e(l({...n,...t}));return r.defaultProps=n,r},e.createDom=V,e.createFiber=ae,e.define=function(e,t,n=D){const{defaultProps:r=D.defaultProps,shadowRoot:s=D.shadowRoot}=n,o=class extends HTMLElement{static get observedAttributes(){return Object.keys(r)}attributeChangedCallback(e,t,n){const r=k.get(this).props;a.isState(r[e])&&r[e].toString()!=n&&"object"!=typeof r[e].value&&(r[e].set(n),console.log(e,n))}constructor(e){super(),e="object"==typeof e&&e?e:{};const s={connectedCallback:d(),disconnectedCallback:d(),adoptedCallback:d(),onCleanup:[()=>{}],mounted:d({onSubscribe:e=>(...t)=>{const n=e(t);n instanceof Function&&this.onCleanup(n)}}),props:e,children:[]};k.set(this,s),m(this),Array.isArray(e.children)&&s.children.push(...e.children);const o=n.shadowRoot?this.attachShadow({mode:"closed"===n.shadowRoot?.mode?"closed":"open",delegatesFocus:!!n.shadowRoot?.delegatesFocus,slotAssignment:"manual"===n.shadowRoot?.slotAssignment?"manual":"named"}):this;m(o);const i=Object.freeze({root:o,el:this,...Object.entries(s).reduce(((e,[t,n])=>(Array.isArray(n)&&(e[t]=n[0]),e)),{})});setTimeout((()=>{Promise.resolve().then((()=>{for(let t of this.attributes){const n=t.name;a.isState(e[n])?e[n].set(t.value):e[n]=t.value}s.props=l({...r,...e}),s.children.push(...this.childNodes);const n=t({...s.props,children:[...s.children]},i);o.append(V(n)),s.mounted[1](this),this.isConnected&&s.connectedCallback[1]()}))}))}connectedCallback(){k.get(this).connectedCallback[1]()}disconnectedCallback(){k.get(this).disconnectedCallback[1]()}adoptedCallback(){k.get(this).adoptedCallback[1]()}};return customElements.define(e,o,{}),e=>new o({children:[],...e})},e.html=re,e.render=T,e.template=ne,e.useEffect=function(e,t=[]){if(!Array.isArray(t))throw new Error("states doit être une Array");const n=[];let r;const o=[...t],i=e=>e instanceof s?e.value:e;return o.forEach(((t,a)=>{t instanceof s&&n.push(t.onChange((()=>{(t=>{Promise.resolve().then((()=>r=e([...o.map(i)],t)))})(a)})))})),requestIdleCallback((()=>r=e([...o.map(i)],-1))),()=>{n.splice(0,n.length).map((e=>e?.())),r instanceof Function&&r(-1,[...o].map(i))}},e.useEvent=d,e.useLayoutEffect=function(e,t=[]){if(!Array.isArray(t))throw new Error("states doit être une Array");const n=[];let r;const o=[...t],i=e=>e instanceof s?e.value:e,a=t=>r=e([...o.map(i)],t);return o.forEach(((e,t)=>{e instanceof s&&n.push(e.onChange((()=>{a(t)})))})),a(-1),()=>{n.splice(0,n.length).map((e=>e?.())),r instanceof Function&&r(-1,[...o].map(i))}},e.useMemo=p,e.useProps=l,e.useRef=u,e.useState=a,e}({});
//# sourceMappingURL=rimax.global.min.js.map
